重构：改善既有代码的设计
------------------------------------

## Chapter 1

如果你要给程序添加一个特性，但发现代码因缺乏**良好的结构**而**不易于进行更改**，那就先重构那个程序，使其比较容易添加该特性，然后再添加该特性。

重构前，先检查自己是否有一套可靠的测试集。这些测试必须有自我检验能力。进行重构时，我需要依赖测试。我将测试视为bug检测器，它们能保护我不被自己犯的错误所困扰。通过测试对当前工作进行二次确认。

**重构技术就是以微小的步伐修改程序。如果你犯下错误，很容易便可发现它。**

傻瓜都能写出计算机可以理解的代码。唯有能写出**人类容易理解的代码**的，才是优秀的程序员。

好代码的检验标准就是人们是否能轻而易举地修改它。小的步子可以更快前进，请保持代码永远处于可工作状态，小步修改累积起来也能大大改善系统的设计。

## Chapter 2





## Chapter 4 测试

#### WHY

- 编写代码的时间仅占所有时间中很少的一部分。有些时间用来决定下一步干什么，有些时间花在设计上，但是，**花费在调试上的时间是最多的**

- 修复bug通常是比较快的，但**找出bug所在却是一场噩梦**。当修复一个bug时，常常会引起另一个bug，却在很久之后才会注意到它。那时，你又要花上大把时间去定位问题。

- 一套测试就是一个强大的bug侦测器，能够大大缩减查找bug所需的时间
- 除非体会到**编写测试是如何提升编程速度**，否则自测试似乎就没有什么意义
- **编写未臻完善的测试**并经常运行，好过对完美测试的无尽等待。

- **一个测试语句中最好只有一个验证语句**，否则测试可能在进行第一个验证时就失败，这通常会掩盖一些重要的错误信息，不利于你了解测试失败的原因。

#### 错误，脏数据

**直接 assert**

如果这个错误会导致脏数据在应用中到处传递，或是产生一些很难调试的失败，我可能会用**引入断言**（302）手法，使代码不满足预设条件时快速失败。我不会为这样的失败断言添加测试，它们本身就是一种测试的形式。

#### 探测边界条件

- 目前为止我的测试都聚焦于正常的行为上，这通常也被称为“正常路径”（happy path），它指的是一切工作正常、用户使用方式也最符合规范的那种场景。同时，把测试推到这些条件的边界处也是不错的实践，这可以检查操作出错时软件的表现。
- 考虑**可能出错的边界条件**，把测试火力集中在那儿。

#### 你应该把测试集中在可能出错的地方。观察代码，看哪儿变得复杂；观察函数，思考哪些地方可能出错。

- 不要因为测试无法捕捉所有的bug就不写测试，因为测试的确可以捕捉到大多数bug

#### 单元测试

负责测试一小块代码，运行速度足够快。它们是自测试代码的支柱，是一个系统中占绝大多数的测试类型

#### 测试三问

与编程的许多方面类似，测试也是一种**迭代**式的活动。除非你技能非常纯熟，或者非常幸运，否则你很难第一次就把测试写对。我发觉我持续地在测试集上工作，就与我在主代码库上的工作一样多。很自然，这意味着我在增加新特性时也要同时添加测试。

有时还需要回顾已有的测试：它们足够清晰吗？我需要重构它们，以帮助我更好地理解吗？我拥有的测试是有价值的吗？

代码足够清晰吗？我需要重构它们，以帮助我更好地理解吗？

#### 什么时候应该添加测试

每当你收到bug报告，请先写一个**单元测试来暴露这个bug**。

